<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>仿真评估工具</title>
    <script src="resource/bootstrap/js/bootstrap.min.js"></script>
    <link href="resource/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .title {
        height: 25px;
        background-color: #4472c4;
        color: white;
        text-align: center;
        line-height: 25px;
      }
      .logo{
        width:60px;height: 50px;
      }
      .heart{
        width:18px;height: 16px;
        vertical-align: top;
      }
      .input{
        width:80%;
        border: 0px;
        /*border-bottom: 1px solid gray;*/
        text-align: right;
        line-height: 15px;
        padding-right:5px;
      }
      table{
        width:100%;
      }
      table td{
        border: solid 1px;
        collapse: 0px;
        border-spacing: 0px;
        width: 50%;
        padding:1px 3px 1px 3px;
        text-align: center;
        background-color: white;
        font-size: small;
      }
    </style>
  </head>
  <body style="width: 900px;background-color: #ffffff;">
    <div style="background-color: #f2f2f2;width:100%;height: 100%;padding:0px 5px 0px 5px;">
      <div style="text-align: center;vertical-align: middle;">
        <span style="font-weight: bold;line-height: 25px;">室内外联合覆盖方案仿真评估工具</span>
      </div>
      <div>
        <div style="width:100%;height:600px;display:inline-block;background-color: #ffffff;vertical-align: top;">
<!--          左-->
          <div class="title">仿真结果</div>
          <div style="padding:0px 5px 0px 5px;">
            <div>
              <input type="text" class="form-control" placeholder="Text input" style="width:60px;">
              <input type="text" class="form-control" id="" value="" placeholder="提示内容">
              <input type="text" class="form-control" id="" value="" placeholder="提示内容">
              <input type="text" class="form-control" id="" value="" placeholder="提示内容">
              <input type="text" class="form-control" id="" value="" placeholder="提示内容">

              <button style="width:100px;height:35px;" class="btn btn-xs btn-primary" id="btn_add">添加</button>
            </div>
            <div style="text-align: right;">
              <button style="width:100px;height:35px;background-color: #FF8E1E;color: white;" id="btn_reset">重置</button>
              <button style="width:100px;height:35px;background-color: #438046;color: white;" id="btn_evaluation">开始计算</button>
            </div>
            <div class="row">
              <div class="col-md-12" style="max-height: 400px;overflow-y: auto;">
              <table class="table table-striped table-bordered" id="table">
                <thead>
                <tr>
                  <th>序号</th>
                  <th>覆盖楼宇高度(m)</th>
                  <th>与对打楼宇间距(m)</th>
                  <th>水平波瓣角(°)</th>
                  <th>垂直波瓣角(°)</th>
                  <th>天线口功率(dbm）</th>
                  <th>天线增益(dbm）</th>
                  <th>建议天线与楼边距离(m)</th>
                  <th>建议天线挂高(m)</th>
                  <th>中心点RSRP(dbm)</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td>1</td>
                  <td>Mark</td>
                  <td>Otto</td>
                  <td>@mdo</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>Jacob</td>
                  <td>Thornton</td>
                  <td>@fat</td>
                </tr>
                <tr>
                  <td>3</td>
                  <td>Larry</td>
                  <td>the Bird</td>
                  <td>@twitter</td>
                </tr>
                </tbody>
              </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <template id="template">
      <tr>
        <td>{{a}}</td>
        <td>{{b}}</td>
        <td>{{c}}</td>
        <td>{{d}}</td>
        <td></td>
        <td></td>
      </tr>
    </template>
    <!-- You can also require other files to run in this process -->
    <script src="./renderer.js"></script>
    <script src="./resource/jquery.min.js"></script>
    <script src="./resource/layer/layer.js"></script>

    <script type="text/javascript">
      $().ready(function () {
        let dataSet=[
          {
            number:1,
            A:10,
            H:20,
            a:10,
            b:10,
            P:10,
            G:10,
            X:0,
            Y:0,
            Z:0
          },{
            number:1,
            A:10,
            H:20,
            a:10,
            b:10,
            P:10,
            G:10,
            X:0,
            Y:0,
            Z:0
          }
        ];

        $("#btn_add").click(function () {
            dataSet.push({});

          // $("#table tbody").append($("#template").html());
          renderer();
        });
        $("#btn_reset").click(function () {
          $("input").val("");
          resetStars();
          resetResult();
        });
        let starCountMap={"cmcc":0,"cu":0,"ct":0};
        $("#btn_evaluation").click(function () {
          /*
          A RSRP (dBm)
          0:[-Infinity,-115)
          1:[-115,-110)
          2:[-110,-105)
          3:[-105,-100)
          4:[-100,-95)
          5:[-95,-85)
          6:[-85,-75)
          7:[-75,0)
          8:[0,Infinity)
          */

          //计算A ≥ -115 的总数
          const sumATotal=sumInput("input_a_",0);
          const sumAGte115=sumInput("input_a_",1);
          const sumAGte110=sumInput("input_a_",2);
          const sumAGte105=sumInput("input_a_",3);
          const sumAGte100=sumInput("input_a_",4);
          const sumAGte95=sumInput("input_a_",5);

          const sumBGte9=sumInput("input_b_",9);
          const sumBGte6=sumInput("input_b_",6);
          const sumBGte5=sumInput("input_b_",5);
          const sumBGte4=sumInput("input_b_",4);
          const sumBGte3=sumInput("input_b_",3);
          const sumBGte2=sumInput("input_b_",2);
          const sumBGte1=sumInput("input_b_",1);
          const sumBTotal=sumInput("input_b_",1);

          const c=getValue($("#input_c"));
          const d=getValue($("#input_d"));
          const e=getValue($("#input_e"));

          if(sumATotal>100){
            layer.alert("RSRP 指标总和不能超过100%！");
            return;
          }
          if(sumBTotal>100){
            layer.alert("RS-SINR 指标总和不能超过100%！");
            return;
          }

          resetStars();
          resetResult();

          //移动
          if(sumAGte95 >=99 && sumBGte9>=99){
            let count;
            //3星
            if(c<=-110 || d-e>=10){
              //满足外泄指标+2星
              count=5;
            }else{
              count=0;
            }
            showStars("cmcc",count);
            showResult("cmcc",0);
          }else if(sumAGte105 >=99 && sumBGte6>=99){
            let count;
            //2星
            if(c<=-110 || d-e>=10){
              //满足外泄指标+2星
              count=4;
            }else{
              count=0;
            }
            showStars("cmcc",count);
            showResult("cmcc",1);
          } else{
            showResult("cmcc",2);
          }

          //联通
          if(sumAGte100>=90 && sumBGte6 >=90){
            //3星
            if(c<=-110 || d-e>=10){
              showStars("cu",5);
            }else{
              showStars("cu",0);
            }
            showResult("cu",0);
          }else if(sumAGte100>=90 && sumBGte5 >=90){
            //3星
            if(c<=-110 || d-e>=10){
              showStars("cu",5);
            }else{
              showStars("cu",0);
            }
            showResult("cu",1);
          }else if(sumAGte105>=90 && sumBGte4 >=90){
            //2星
            if(c<=-110 || d-e>=10){
              showStars("cu",4);
            }else{
              showStars("cu",0);
            }
            showResult("cu",2);
          }else if(sumAGte105>=90 && sumBGte3 >=90){
            //2星
            if(c<=-110 || d-e>=10){
              showStars("cu",4);
            }else{
              showStars("cu",0);
            }
            showResult("cu",3);
          }else if(sumAGte110>=90 && sumBGte2 >=90){
            //1星
            if(c<=-110 || d-e>=10){
              showStars("cu",3);
            }else{
              showStars("cu",0);
            }
            showResult("cu",4);
          }else if(sumAGte110>=90 && sumBGte1 >=90){
            //1星
            if(c<=-110 || d-e>=10){
              showStars("cu",3);
            }else{
              showStars("cu",0);
            }
            showResult("cu",5);
          }else{
            showResult("cu",6);
          }

          //电信
          if(sumAGte115>=95 && sumBGte3 >=95){
            //3星
            if(c<=-110 || d-e>=10){
              showStars("ct",5);
            }else{
              showStars("ct",0);
            }
            showResult("ct",0);
          }else{
            showResult("ct",1);
          }

          //外泄指标
          if(c<=-110 || d-e>=10){
            showResult("leak",0);
          }else{
            showResult("leak",1);
          }

        });

        function sumInput(prefix,startLevel) {
          let sum = 0;
          for (let i = startLevel; i <= 9; i++) {
            let input = $("#"+prefix + i+"");
            // console.log(input.id);
            sum += parseFloat(getValue(input));
          }
          return sum;
        }

        function getValue(input) {
          if (!!input && !!input.val()) {
            return input.val();
          } else {
            return 0;
          }

        }

        function resetStars() {
          starCountMap={"cmcc":0,"cu":0,"ct":0}
          $("img.heart").attr("src","./resource/image/heart-empty.png");
        }

        function showStars(operator,count) {
          let images=$("#div_"+operator+"_heart img");
          for(let i=0;i<count;i++){
            images[i].src="./resource/image/heart-red.png";
          }
        }

        function resetResult() {
          $("#div_result").html("");
        }
        function showResult(operator, index) {
          $("#div_result").append(results[operator][index]+"<br/>");
        }

        /**
         * 渲染表格数据
         */
        function renderer() {

        }

        const results={
          "cmcc":["覆盖指标满足中国移动重点场景要求。","覆盖指标仅满足中国移动一般场景要求。","覆盖指标不满足中国移动要求。"],
          "cu":["覆盖指标满足中国联通双通道高标准要求。","覆盖指标满足中国联通单通道高标准要求。","覆盖指标仅满足中国联通双通道一般标准要求。","覆盖指标仅满足中国联通单通道一般标准要求。","覆盖指标仅满足中国联通双通道低标准要求。","覆盖指标仅满足中国联通单通道低标准要求。","覆盖指标不满足中国联通要求。"],
          "ct":["覆盖指标满足中国电信要求。","覆盖指标不满足中国电信要求。","覆盖指标不满足中国移动要求。"],
          "leak":["外泄指标满足要求。","外泄指标不满足要求。"]
        };
      });
    </script>
  </body>
</html>
